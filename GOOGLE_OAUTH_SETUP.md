# Google OAuth Setup Guide

## The "Malformed Request" Error

The error "The server cannot process the request because it is malformed" typically occurs due to:

1. **Invalid or placeholder Client IDs** - The most common cause
2. **Missing or incorrect Redirect URI** - Must match Google Console configuration
3. **Missing OAuth scopes** - Required for proper authentication flow
4. **Incorrect OAuth configuration** - Wrong client ID for platform

## Step-by-Step Setup

### 1. Create Google OAuth Credentials

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Create a new project or select existing one
3. Enable the **Google+ API** and **Google Sign-In API**
4. Go to **Credentials** → **Create Credentials** → **OAuth 2.0 Client IDs**

### 2. Configure OAuth Client IDs

Create separate client IDs for each platform:

#### Web Client ID

- **Application type**: Web application
- **Authorized redirect URIs**:
  - For development: `https://auth.expo.io/@your-username/your-app-slug`
  - For production: Your custom redirect URI

#### Android Client ID

- **Application type**: Android
- **Package name**: Your app's package name (from app.json)
- **SHA-1 certificate fingerprint**: Get from your keystore

#### iOS Client ID

- **Application type**: iOS
- **Bundle ID**: Your app's bundle identifier (from app.json)

### 3. Update oauthConfig.ts

Replace the placeholder values in `config/oauth.ts`:

```typescript
export const oauthConfig = {
  google: {
    expoClientId: "your-actual-expo-client-id.apps.googleusercontent.com",
    iosClientId: "your-actual-ios-client-id.apps.googleusercontent.com",
    androidClientId: "your-actual-android-client-id.apps.googleusercontent.com",
    webClientId: "your-actual-web-client-id.apps.googleusercontent.com",
  },
  // ... rest of config
};
```

### 4. Verify Redirect URI

The redirect URI is automatically generated by `AuthSession.makeRedirectUri()`. To see what it generates:

```javascript
console.log("Redirect URI:", AuthSession.makeRedirectUri());
```

Make sure this URI is added to your Google Console's authorized redirect URIs.

### 5. Test the Configuration

1. Check console logs for any configuration errors
2. Verify the client ID is being used correctly
3. Ensure the redirect URI matches Google Console settings

## Common Issues and Solutions

### Issue: "Invalid client" error

**Solution**: Verify client IDs are correct and match the platform

### Issue: "Redirect URI mismatch" error

**Solution**: Add the generated redirect URI to Google Console

### Issue: "Access blocked" error

**Solution**: Enable the required APIs in Google Console

### Issue: "Malformed request" error

**Solution**: Check that all required parameters (scopes, redirectUri) are provided

## Development vs Production

### Development

- Use Expo's proxy service for redirect URI
- Client IDs can be from any Google project

### Production

- Set up custom redirect URI scheme
- Use production client IDs
- Configure proper bundle identifiers

## Testing

After configuration, test the flow:

1. Click Google Sign-In button
2. Check console for any errors
3. Verify the OAuth flow completes successfully
4. Ensure user data is received correctly

## Security Notes

- Never commit real client IDs to version control
- Use environment variables for production
- Regularly rotate client secrets
- Monitor OAuth usage in Google Console
